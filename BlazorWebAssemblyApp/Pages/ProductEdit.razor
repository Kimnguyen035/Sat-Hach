@page "/edit/{Id}"
@using WebModels;
@using BlazorWebAssemblyApp.Services;
@using BlazorWebAssemblyApp.Components;

@inject IProductApiClient productApiClient;
@inject NavigationManager NavigationManager;
@inject IToastService ToastService
@if (product == null)
{
    <LoadingIndicator></LoadingIndicator>
}
else
{
    <h3>Product Edit: @product.Name</h3>

    <EditForm Model="product" OnValidSubmit="SubmitTask">
        <DataAnnotationsValidator />
        <div class="form-group">
            <label for="Name">Product Name</label>
            <InputText class="form-control" @bind-Value="product.Name"></InputText>
            <ValidationMessage For="()=>product.Name"></ValidationMessage>
            <small id="nameHelp" class="form-text text-muted">Please enter product title here.</small>
        </div>
        <div class="form-group">
            <label for="Name">Price</label>
            <InputNumber class="form-control" @bind-Value="product.Price"></InputNumber>
            <ValidationMessage For="()=>product.Price"></ValidationMessage>
            <small id="nameHelp" class="form-text text-muted">Please enter product title here.</small>
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
    </EditForm>

}

@code {
    [Parameter]
    public string Id { set; get; }

    private UpdateProduct product;

    protected async override Task OnInitializedAsync()
    {
        var producted = await productApiClient.GetDetail(Id);
        product = new UpdateProduct();
        product.Name = producted.Name;
        product.Price = producted.Price;
    }

    private async Task SubmitTask(EditContext context)
    {
        var result = await productApiClient.UpdateProduct(Guid.Parse(Id), product);
        if (result)
        {
            ToastService.ShowSuccess($"{product.Name} has been updated successfully.", "Success");
            NavigationManager.NavigateTo("/productList");
        }
        else
        {
            ToastService.ShowError($"An error occurred in progress. Please contact to administrator.", "Error");

        }
    }
}